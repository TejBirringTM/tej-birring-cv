---
import { marked } from 'marked';
import { getCollection } from 'astro:content';
import SectionHeading from './SectionHeading.astro';
import { Icon } from 'astro-icon/components'
import dayjs from "dayjs"
const professionalExperience = (await getCollection("professional-experience")).sort((a, b)=>{
    const dateA = a.data.to === 'present' ? new Date() : new Date(a.data.to.year, a.data.to.month - 1);
    const dateB = b.data.to === 'present' ? new Date() : new Date(b.data.to.year, b.data.to.month - 1);
    return dateB.getTime() - dateA.getTime();
});
---
{
    professionalExperience.length > 0 && 
    <section>
        <SectionHeading title="Professional Experience" />
        <div class="space-y-6">
            {professionalExperience.map((exp)=>(
                <div>
                    <h3 class="leading-none font-bold mb-0.5">{exp.data.title}</h3>

                    <div class="ml-3">
                        <h3 class="leading-none text-secondary mb-1"><em>at </em> <span class="font-medium">{exp.data.company}</span></h3>
                        <div class="flex flex-wrap text-secondary/80 gap-1 mb-2 text-[0.8rem]">
                            <div class="flex flex-row items-center leading-none mr-4">
                                <Icon name="pin" class="mr-1"/>
                                {exp.data.location}
                            </div>
                            <div class="flex flex-row items-center leading-none">
                                <Icon name="calendar" class="mr-1"/>
                                {dayjs(new Date(exp.data.from.year, exp.data.from.month-1)).format('MMM YYYY')} - 
                                {
                                    exp.data.to !== 'present' &&
                                    dayjs(new Date(exp.data.to.year, exp.data.to.month-1)).format('MMM YYYY')
                                }
                                {
                                    exp.data.to === 'present' && "Present"
                                }
                            </div>
                        </div>
                    </div>

                    <div set:html={marked(exp.body)} class="prose prose-sm text-secondary leading-[1.2] prose-li:mt-2 " />
                </div>
            ))}         
        </div>
    </section>
}